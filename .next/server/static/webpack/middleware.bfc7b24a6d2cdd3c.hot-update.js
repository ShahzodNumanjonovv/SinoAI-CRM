"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n// middleware.ts\n\nconst PUBLIC_API_PREFIXES = [\n    \"/api/miniapp\"\n]; // ⬅️ miniapp API-lari bypass\nconst PROTECTED_PREFIXES = [\n    \"/patients\",\n    \"/appointments\",\n    \"/statistics\",\n    \"/users\",\n    \"/doctors\",\n    \"/invoices\",\n    \"/api\"\n];\nasync function middleware(req) {\n    const { pathname } = req.nextUrl;\n    // static/public fayllarni o'tkazib yuboramiz\n    if (pathname.startsWith(\"/_next\") || pathname.startsWith(\"/favicon\") || pathname.startsWith(\"/icons\") || pathname.startsWith(\"/img\") || pathname === \"/\") {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // ⬇️ miniapp API-larini mutlaqo tekshirmaymiz — redirect bo‘lmasin\n    if (PUBLIC_API_PREFIXES.some((p)=>pathname.startsWith(p))) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    const token = req.cookies.get(AUTH_COOKIE)?.value ?? null;\n    const user = token ? await verifyToken(token, AUTH_SECRET) : null;\n    const isLoginPage = pathname === \"/login\";\n    const isProtected = PROTECTED_PREFIXES.some((p)=>pathname.startsWith(p)) && !pathname.startsWith(\"/api/auth\");\n    // Login sahifasiga kirgan bo‘lsa va allaqachon login bo‘lsa — statistikaga yo‘naltiramiz\n    if (isLoginPage && user) {\n        const url = req.nextUrl.clone();\n        url.pathname = \"/statistics\";\n        url.search = \"\";\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    // Protected yo‘llar va login qilinmagan holat\n    if (isProtected && !user) {\n        // API bo‘lsa JSON 401 qaytaramiz; aks holda /login ga redirect\n        if (pathname.startsWith(\"/api\")) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                ok: false,\n                message: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const url = req.nextUrl.clone();\n        url.pathname = \"/login\";\n        url.searchParams.set(\"next\", pathname + (req.nextUrl.search || \"\"));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\nconst config = {\n    matcher: [\n        \"/((?!_next/static|_next/image|favicon.ico|icons/|img/).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxnQkFBZ0I7QUFDd0M7QUFHeEQsTUFBTUMsc0JBQXNCO0lBQUM7Q0FBZSxFQUFJLDZCQUE2QjtBQUM3RSxNQUFNQyxxQkFBcUI7SUFDekI7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7Q0FDRDtBQUVNLGVBQWVDLFdBQVdDLEdBQWdCO0lBQy9DLE1BQU0sRUFBRUMsUUFBUSxFQUFFLEdBQUdELElBQUlFLE9BQU87SUFFaEMsNkNBQTZDO0lBQzdDLElBQ0VELFNBQVNFLFVBQVUsQ0FBQyxhQUNwQkYsU0FBU0UsVUFBVSxDQUFDLGVBQ3BCRixTQUFTRSxVQUFVLENBQUMsYUFDcEJGLFNBQVNFLFVBQVUsQ0FBQyxXQUNwQkYsYUFBYSxLQUNiO1FBQ0EsT0FBT0wscURBQVlBLENBQUNRLElBQUk7SUFDMUI7SUFFQSxtRUFBbUU7SUFDbkUsSUFBSVAsb0JBQW9CUSxJQUFJLENBQUMsQ0FBQ0MsSUFBTUwsU0FBU0UsVUFBVSxDQUFDRyxLQUFLO1FBQzNELE9BQU9WLHFEQUFZQSxDQUFDUSxJQUFJO0lBQzFCO0lBRUEsTUFBTUcsUUFBUVAsSUFBSVEsT0FBTyxDQUFDQyxHQUFHLENBQUNDLGNBQWNDLFNBQVM7SUFDckQsTUFBTUMsT0FBT0wsUUFBUSxNQUFNTSxZQUFZTixPQUFPTyxlQUFlO0lBRTdELE1BQU1DLGNBQWNkLGFBQWE7SUFDakMsTUFBTWUsY0FDSmxCLG1CQUFtQk8sSUFBSSxDQUFDLENBQUNDLElBQU1MLFNBQVNFLFVBQVUsQ0FBQ0csT0FDbkQsQ0FBQ0wsU0FBU0UsVUFBVSxDQUFDO0lBRXZCLHlGQUF5RjtJQUN6RixJQUFJWSxlQUFlSCxNQUFNO1FBQ3ZCLE1BQU1LLE1BQU1qQixJQUFJRSxPQUFPLENBQUNnQixLQUFLO1FBQzdCRCxJQUFJaEIsUUFBUSxHQUFHO1FBQ2ZnQixJQUFJRSxNQUFNLEdBQUc7UUFDYixPQUFPdkIscURBQVlBLENBQUN3QixRQUFRLENBQUNIO0lBQy9CO0lBRUEsOENBQThDO0lBQzlDLElBQUlELGVBQWUsQ0FBQ0osTUFBTTtRQUN4QiwrREFBK0Q7UUFDL0QsSUFBSVgsU0FBU0UsVUFBVSxDQUFDLFNBQVM7WUFDL0IsT0FBT1AscURBQVlBLENBQUN5QixJQUFJLENBQUM7Z0JBQUVDLElBQUk7Z0JBQU9DLFNBQVM7WUFBZSxHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDakY7UUFDQSxNQUFNUCxNQUFNakIsSUFBSUUsT0FBTyxDQUFDZ0IsS0FBSztRQUM3QkQsSUFBSWhCLFFBQVEsR0FBRztRQUNmZ0IsSUFBSVEsWUFBWSxDQUFDQyxHQUFHLENBQUMsUUFBUXpCLFdBQVlELENBQUFBLElBQUlFLE9BQU8sQ0FBQ2lCLE1BQU0sSUFBSSxFQUFDO1FBQ2hFLE9BQU92QixxREFBWUEsQ0FBQ3dCLFFBQVEsQ0FBQ0g7SUFDL0I7SUFFQSxPQUFPckIscURBQVlBLENBQUNRLElBQUk7QUFDMUI7QUFFTyxNQUFNdUIsU0FBUztJQUNwQkMsU0FBUztRQUFDO0tBQTREO0FBQ3hFLEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zaGFoem9kbnVtYW5qb25vdi9EZXNrdG9wL2VjbGluaWMtc2Fhcy9taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIG1pZGRsZXdhcmUudHNcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCB7IGhhc0F1dGhDb29raWUgfSBmcm9tIFwiQC9saWIvYXV0aFwiO1xuXG5jb25zdCBQVUJMSUNfQVBJX1BSRUZJWEVTID0gW1wiL2FwaS9taW5pYXBwXCJdOyAgIC8vIOKshe+4jyBtaW5pYXBwIEFQSS1sYXJpIGJ5cGFzc1xuY29uc3QgUFJPVEVDVEVEX1BSRUZJWEVTID0gW1xuICBcIi9wYXRpZW50c1wiLFxuICBcIi9hcHBvaW50bWVudHNcIixcbiAgXCIvc3RhdGlzdGljc1wiLFxuICBcIi91c2Vyc1wiLFxuICBcIi9kb2N0b3JzXCIsXG4gIFwiL2ludm9pY2VzXCIsXG4gIFwiL2FwaVwiLCAgICAgICAgICAgICAgICAgLy8gdW11bWl5IC9hcGkgaGFtIHByb3RlY3RlZCwgbGVraW4gUFVCTElDX0FQSV9QUkVGSVhFUyBvbGRpbiB0ZWtzaGlyaWxhZGlcbl07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgeyBwYXRobmFtZSB9ID0gcmVxLm5leHRVcmw7XG5cbiAgLy8gc3RhdGljL3B1YmxpYyBmYXlsbGFybmkgbyd0a2F6aWIgeXVib3JhbWl6XG4gIGlmIChcbiAgICBwYXRobmFtZS5zdGFydHNXaXRoKFwiL19uZXh0XCIpIHx8XG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9mYXZpY29uXCIpIHx8XG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9pY29uc1wiKSB8fFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaW1nXCIpIHx8XG4gICAgcGF0aG5hbWUgPT09IFwiL1wiXG4gICkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xuICB9XG5cbiAgLy8g4qyH77iPIG1pbmlhcHAgQVBJLWxhcmluaSBtdXRsYXFvIHRla3NoaXJtYXltaXog4oCUIHJlZGlyZWN0IGJv4oCYbG1hc2luXG4gIGlmIChQVUJMSUNfQVBJX1BSRUZJWEVTLnNvbWUoKHApID0+IHBhdGhuYW1lLnN0YXJ0c1dpdGgocCkpKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG4gIH1cblxuICBjb25zdCB0b2tlbiA9IHJlcS5jb29raWVzLmdldChBVVRIX0NPT0tJRSk/LnZhbHVlID8/IG51bGw7XG4gIGNvbnN0IHVzZXIgPSB0b2tlbiA/IGF3YWl0IHZlcmlmeVRva2VuKHRva2VuLCBBVVRIX1NFQ1JFVCkgOiBudWxsO1xuXG4gIGNvbnN0IGlzTG9naW5QYWdlID0gcGF0aG5hbWUgPT09IFwiL2xvZ2luXCI7XG4gIGNvbnN0IGlzUHJvdGVjdGVkID1cbiAgICBQUk9URUNURURfUFJFRklYRVMuc29tZSgocCkgPT4gcGF0aG5hbWUuc3RhcnRzV2l0aChwKSkgJiZcbiAgICAhcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9hcGkvYXV0aFwiKTtcblxuICAvLyBMb2dpbiBzYWhpZmFzaWdhIGtpcmdhbiBib+KAmGxzYSB2YSBhbGxhcWFjaG9uIGxvZ2luIGJv4oCYbHNhIOKAlCBzdGF0aXN0aWthZ2EgeW/igJhuYWx0aXJhbWl6XG4gIGlmIChpc0xvZ2luUGFnZSAmJiB1c2VyKSB7XG4gICAgY29uc3QgdXJsID0gcmVxLm5leHRVcmwuY2xvbmUoKTtcbiAgICB1cmwucGF0aG5hbWUgPSBcIi9zdGF0aXN0aWNzXCI7XG4gICAgdXJsLnNlYXJjaCA9IFwiXCI7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdCh1cmwpO1xuICB9XG5cbiAgLy8gUHJvdGVjdGVkIHlv4oCYbGxhciB2YSBsb2dpbiBxaWxpbm1hZ2FuIGhvbGF0XG4gIGlmIChpc1Byb3RlY3RlZCAmJiAhdXNlcikge1xuICAgIC8vIEFQSSBib+KAmGxzYSBKU09OIDQwMSBxYXl0YXJhbWl6OyBha3MgaG9sZGEgL2xvZ2luIGdhIHJlZGlyZWN0XG4gICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvYXBpXCIpKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogZmFsc2UsIG1lc3NhZ2U6IFwiVW5hdXRob3JpemVkXCIgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICB9XG4gICAgY29uc3QgdXJsID0gcmVxLm5leHRVcmwuY2xvbmUoKTtcbiAgICB1cmwucGF0aG5hbWUgPSBcIi9sb2dpblwiO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwibmV4dFwiLCBwYXRobmFtZSArIChyZXEubmV4dFVybC5zZWFyY2ggfHwgXCJcIikpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QodXJsKTtcbiAgfVxuXG4gIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xufVxuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBtYXRjaGVyOiBbXCIvKCg/IV9uZXh0L3N0YXRpY3xfbmV4dC9pbWFnZXxmYXZpY29uLmljb3xpY29ucy98aW1nLykuKilcIl0sXG59OyJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJQVUJMSUNfQVBJX1BSRUZJWEVTIiwiUFJPVEVDVEVEX1BSRUZJWEVTIiwibWlkZGxld2FyZSIsInJlcSIsInBhdGhuYW1lIiwibmV4dFVybCIsInN0YXJ0c1dpdGgiLCJuZXh0Iiwic29tZSIsInAiLCJ0b2tlbiIsImNvb2tpZXMiLCJnZXQiLCJBVVRIX0NPT0tJRSIsInZhbHVlIiwidXNlciIsInZlcmlmeVRva2VuIiwiQVVUSF9TRUNSRVQiLCJpc0xvZ2luUGFnZSIsImlzUHJvdGVjdGVkIiwidXJsIiwiY2xvbmUiLCJzZWFyY2giLCJyZWRpcmVjdCIsImpzb24iLCJvayIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJzZWFyY2hQYXJhbXMiLCJzZXQiLCJjb25maWciLCJtYXRjaGVyIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});