"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(middleware)/./lib/auth.ts\");\n// middleware.ts\n\n\nasync function middleware(req) {\n    const { pathname } = req.nextUrl;\n    // 1) Static/publiclarni chetlab o‘tamiz\n    if (pathname.startsWith(\"/_next\") || pathname.startsWith(\"/favicon\") || pathname.startsWith(\"/icons\") || pathname.startsWith(\"/img\") || pathname === \"/\") {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // 2) CORS preflight (miniapp uchun muhim) — har doim o‘tkazamiz\n    if (req.method === \"OPTIONS\") {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // 3) Auth cookie bor-yo‘qligi\n    const token = req.cookies.get(_lib_auth__WEBPACK_IMPORTED_MODULE_1__.AUTH_COOKIE)?.value || null;\n    const user = token ? await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyToken)(token, _lib_auth__WEBPACK_IMPORTED_MODULE_1__.AUTH_SECRET) : null;\n    const isLoginPage = pathname === \"/login\";\n    // 4) API yo‘llaridan himoyalanadiganlari:\n    //    - /api/auth/* -> har doim ruxsat\n    //    - /api/miniapp/* -> HAR DOIM ruxsat (miniapp front uchun)\n    //    - /api/* (boshqa hammasi) -> login talab qilinadi\n    const isAuthApi = pathname.startsWith(\"/api/auth\");\n    const isMiniappApi = pathname.startsWith(\"/api/miniapp\");\n    const isOtherApi = pathname.startsWith(\"/api\") && !isAuthApi && !isMiniappApi;\n    // 5) App UI sahifalari (SSR) — login talab qilinadiganlari:\n    const needsAuthPage = pathname.startsWith(\"/patients\") || pathname.startsWith(\"/appointments\") || pathname.startsWith(\"/statistics\") || pathname.startsWith(\"/users\") || pathname.startsWith(\"/doctors\") || pathname.startsWith(\"/services\") || pathname.startsWith(\"/invoices\");\n    // 6) Agar login sahifasiga kelgan va allaqachon login bo‘lsa -> /statistics\n    if (isLoginPage && user) {\n        const url = req.nextUrl.clone();\n        url.pathname = \"/statistics\";\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    // 7) API (himoyalangan) yoki UI (needsAuthPage) uchun auth tekshiruvi\n    if ((isOtherApi || needsAuthPage) && !user) {\n        // API so‘rovlari JSON emas, redirect bo‘ladi — brauzerda bu 307 bo‘lib ko‘rinadi\n        const url = req.nextUrl.clone();\n        url.pathname = \"/login\";\n        url.searchParams.set(\"next\", pathname);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\nconst config = {\n    matcher: [\n        \"/((?!_next/static|_next/image|favicon.ico|icons/|img/).*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsZ0JBQWdCO0FBQ3dDO0FBQ1c7QUFFNUQsZUFBZUksV0FBV0MsR0FBZ0I7SUFDL0MsTUFBTSxFQUFFQyxRQUFRLEVBQUUsR0FBR0QsSUFBSUUsT0FBTztJQUVoQyx3Q0FBd0M7SUFDeEMsSUFDRUQsU0FBU0UsVUFBVSxDQUFDLGFBQ3BCRixTQUFTRSxVQUFVLENBQUMsZUFDcEJGLFNBQVNFLFVBQVUsQ0FBQyxhQUNwQkYsU0FBU0UsVUFBVSxDQUFDLFdBQ3BCRixhQUFhLEtBQ2I7UUFDQSxPQUFPTixxREFBWUEsQ0FBQ1MsSUFBSTtJQUMxQjtJQUVBLGdFQUFnRTtJQUNoRSxJQUFJSixJQUFJSyxNQUFNLEtBQUssV0FBVztRQUM1QixPQUFPVixxREFBWUEsQ0FBQ1MsSUFBSTtJQUMxQjtJQUVBLDhCQUE4QjtJQUM5QixNQUFNRSxRQUFRTixJQUFJTyxPQUFPLENBQUNDLEdBQUcsQ0FBQ1Ysa0RBQVdBLEdBQUdXLFNBQVM7SUFDckQsTUFBTUMsT0FBT0osUUFBUSxNQUFNVixzREFBV0EsQ0FBQ1UsT0FBT1Qsa0RBQVdBLElBQUk7SUFFN0QsTUFBTWMsY0FBY1YsYUFBYTtJQUVqQywwQ0FBMEM7SUFDMUMsc0NBQXNDO0lBQ3RDLCtEQUErRDtJQUMvRCx1REFBdUQ7SUFDdkQsTUFBTVcsWUFBWVgsU0FBU0UsVUFBVSxDQUFDO0lBQ3RDLE1BQU1VLGVBQWVaLFNBQVNFLFVBQVUsQ0FBQztJQUN6QyxNQUFNVyxhQUFhYixTQUFTRSxVQUFVLENBQUMsV0FBVyxDQUFDUyxhQUFhLENBQUNDO0lBRWpFLDREQUE0RDtJQUM1RCxNQUFNRSxnQkFDSmQsU0FBU0UsVUFBVSxDQUFDLGdCQUNwQkYsU0FBU0UsVUFBVSxDQUFDLG9CQUNwQkYsU0FBU0UsVUFBVSxDQUFDLGtCQUNwQkYsU0FBU0UsVUFBVSxDQUFDLGFBQ3BCRixTQUFTRSxVQUFVLENBQUMsZUFDcEJGLFNBQVNFLFVBQVUsQ0FBQyxnQkFDcEJGLFNBQVNFLFVBQVUsQ0FBQztJQUV0Qiw0RUFBNEU7SUFDNUUsSUFBSVEsZUFBZUQsTUFBTTtRQUN2QixNQUFNTSxNQUFNaEIsSUFBSUUsT0FBTyxDQUFDZSxLQUFLO1FBQzdCRCxJQUFJZixRQUFRLEdBQUc7UUFDZixPQUFPTixxREFBWUEsQ0FBQ3VCLFFBQVEsQ0FBQ0Y7SUFDL0I7SUFFQSxzRUFBc0U7SUFDdEUsSUFBSSxDQUFDRixjQUFjQyxhQUFZLEtBQU0sQ0FBQ0wsTUFBTTtRQUMxQyxpRkFBaUY7UUFDakYsTUFBTU0sTUFBTWhCLElBQUlFLE9BQU8sQ0FBQ2UsS0FBSztRQUM3QkQsSUFBSWYsUUFBUSxHQUFHO1FBQ2ZlLElBQUlHLFlBQVksQ0FBQ0MsR0FBRyxDQUFDLFFBQVFuQjtRQUM3QixPQUFPTixxREFBWUEsQ0FBQ3VCLFFBQVEsQ0FBQ0Y7SUFDL0I7SUFFQSxPQUFPckIscURBQVlBLENBQUNTLElBQUk7QUFDMUI7QUFFTyxNQUFNaUIsU0FBUztJQUNwQkMsU0FBUztRQUFDO0tBQTREO0FBQ3hFLEVBQUUiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zaGFoem9kbnVtYW5qb25vdi9EZXNrdG9wL2VjbGluaWMtc2Fhcy9taWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIG1pZGRsZXdhcmUudHNcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCB7IHZlcmlmeVRva2VuLCBBVVRIX1NFQ1JFVCwgQVVUSF9DT09LSUUgfSBmcm9tIFwiQC9saWIvYXV0aFwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWlkZGxld2FyZShyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHsgcGF0aG5hbWUgfSA9IHJlcS5uZXh0VXJsO1xuXG4gIC8vIDEpIFN0YXRpYy9wdWJsaWNsYXJuaSBjaGV0bGFiIG/igJh0YW1pelxuICBpZiAoXG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9fbmV4dFwiKSB8fFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvZmF2aWNvblwiKSB8fFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaWNvbnNcIikgfHxcbiAgICBwYXRobmFtZS5zdGFydHNXaXRoKFwiL2ltZ1wiKSB8fFxuICAgIHBhdGhuYW1lID09PSBcIi9cIlxuICApIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgfVxuXG4gIC8vIDIpIENPUlMgcHJlZmxpZ2h0IChtaW5pYXBwIHVjaHVuIG11aGltKSDigJQgaGFyIGRvaW0gb+KAmHRrYXphbWl6XG4gIGlmIChyZXEubWV0aG9kID09PSBcIk9QVElPTlNcIikge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xuICB9XG5cbiAgLy8gMykgQXV0aCBjb29raWUgYm9yLXlv4oCYcWxpZ2lcbiAgY29uc3QgdG9rZW4gPSByZXEuY29va2llcy5nZXQoQVVUSF9DT09LSUUpPy52YWx1ZSB8fCBudWxsO1xuICBjb25zdCB1c2VyID0gdG9rZW4gPyBhd2FpdCB2ZXJpZnlUb2tlbih0b2tlbiwgQVVUSF9TRUNSRVQpIDogbnVsbDtcblxuICBjb25zdCBpc0xvZ2luUGFnZSA9IHBhdGhuYW1lID09PSBcIi9sb2dpblwiO1xuXG4gIC8vIDQpIEFQSSB5b+KAmGxsYXJpZGFuIGhpbW95YWxhbmFkaWdhbmxhcmk6XG4gIC8vICAgIC0gL2FwaS9hdXRoLyogLT4gaGFyIGRvaW0gcnV4c2F0XG4gIC8vICAgIC0gL2FwaS9taW5pYXBwLyogLT4gSEFSIERPSU0gcnV4c2F0IChtaW5pYXBwIGZyb250IHVjaHVuKVxuICAvLyAgICAtIC9hcGkvKiAoYm9zaHFhIGhhbW1hc2kpIC0+IGxvZ2luIHRhbGFiIHFpbGluYWRpXG4gIGNvbnN0IGlzQXV0aEFwaSA9IHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvYXBpL2F1dGhcIik7XG4gIGNvbnN0IGlzTWluaWFwcEFwaSA9IHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvYXBpL21pbmlhcHBcIik7XG4gIGNvbnN0IGlzT3RoZXJBcGkgPSBwYXRobmFtZS5zdGFydHNXaXRoKFwiL2FwaVwiKSAmJiAhaXNBdXRoQXBpICYmICFpc01pbmlhcHBBcGk7XG5cbiAgLy8gNSkgQXBwIFVJIHNhaGlmYWxhcmkgKFNTUikg4oCUIGxvZ2luIHRhbGFiIHFpbGluYWRpZ2FubGFyaTpcbiAgY29uc3QgbmVlZHNBdXRoUGFnZSA9XG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9wYXRpZW50c1wiKSB8fFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvYXBwb2ludG1lbnRzXCIpIHx8XG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9zdGF0aXN0aWNzXCIpIHx8XG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi91c2Vyc1wiKSB8fFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvZG9jdG9yc1wiKSB8fFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvc2VydmljZXNcIikgfHxcbiAgICBwYXRobmFtZS5zdGFydHNXaXRoKFwiL2ludm9pY2VzXCIpO1xuXG4gIC8vIDYpIEFnYXIgbG9naW4gc2FoaWZhc2lnYSBrZWxnYW4gdmEgYWxsYXFhY2hvbiBsb2dpbiBib+KAmGxzYSAtPiAvc3RhdGlzdGljc1xuICBpZiAoaXNMb2dpblBhZ2UgJiYgdXNlcikge1xuICAgIGNvbnN0IHVybCA9IHJlcS5uZXh0VXJsLmNsb25lKCk7XG4gICAgdXJsLnBhdGhuYW1lID0gXCIvc3RhdGlzdGljc1wiO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QodXJsKTtcbiAgfVxuXG4gIC8vIDcpIEFQSSAoaGltb3lhbGFuZ2FuKSB5b2tpIFVJIChuZWVkc0F1dGhQYWdlKSB1Y2h1biBhdXRoIHRla3NoaXJ1dmlcbiAgaWYgKChpc090aGVyQXBpIHx8IG5lZWRzQXV0aFBhZ2UpICYmICF1c2VyKSB7XG4gICAgLy8gQVBJIHNv4oCYcm92bGFyaSBKU09OIGVtYXMsIHJlZGlyZWN0IGJv4oCYbGFkaSDigJQgYnJhdXplcmRhIGJ1IDMwNyBib+KAmGxpYiBrb+KAmHJpbmFkaVxuICAgIGNvbnN0IHVybCA9IHJlcS5uZXh0VXJsLmNsb25lKCk7XG4gICAgdXJsLnBhdGhuYW1lID0gXCIvbG9naW5cIjtcbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChcIm5leHRcIiwgcGF0aG5hbWUpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QodXJsKTtcbiAgfVxuXG4gIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xufVxuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBtYXRjaGVyOiBbXCIvKCg/IV9uZXh0L3N0YXRpY3xfbmV4dC9pbWFnZXxmYXZpY29uLmljb3xpY29ucy98aW1nLykuKilcIl0sXG59OyJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ2ZXJpZnlUb2tlbiIsIkFVVEhfU0VDUkVUIiwiQVVUSF9DT09LSUUiLCJtaWRkbGV3YXJlIiwicmVxIiwicGF0aG5hbWUiLCJuZXh0VXJsIiwic3RhcnRzV2l0aCIsIm5leHQiLCJtZXRob2QiLCJ0b2tlbiIsImNvb2tpZXMiLCJnZXQiLCJ2YWx1ZSIsInVzZXIiLCJpc0xvZ2luUGFnZSIsImlzQXV0aEFwaSIsImlzTWluaWFwcEFwaSIsImlzT3RoZXJBcGkiLCJuZWVkc0F1dGhQYWdlIiwidXJsIiwiY2xvbmUiLCJyZWRpcmVjdCIsInNlYXJjaFBhcmFtcyIsInNldCIsImNvbmZpZyIsIm1hdGNoZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});