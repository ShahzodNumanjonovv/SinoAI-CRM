"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(middleware)/./lib/auth.ts\");\n// middleware.ts\n\n\nconst PROTECTED_PREFIXES = [\n    \"/patients\",\n    \"/appointments\",\n    \"/statistics\",\n    \"/api\"\n];\n// ⬇⬇⬇ MATCHER ni yangilang: api/miniapp ni chiqarib tashlaymiz\nconst config = {\n    matcher: [\n        // _next, images, favicon, icons/img VA eng muhimi: api/miniapp NI EXCLUDE qilamiz\n        \"/((?!_next/static|_next/image|favicon.ico|icons/|img/|api/miniapp).*)\"\n    ]\n};\nasync function middleware(req) {\n    const { pathname } = req.nextUrl;\n    // public static\n    if (pathname.startsWith(\"/_next\") || pathname.startsWith(\"/favicon\") || pathname.startsWith(\"/icons\") || pathname.startsWith(\"/img\") || pathname === \"/\") {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // ✅ Agar baribir matcherga tushib qolsa ham, api/miniapp’ni qo‘yib yuboramiz\n    if (pathname.startsWith(\"/api/miniapp\")) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    const token = req.cookies.get(_lib_auth__WEBPACK_IMPORTED_MODULE_1__.AUTH_COOKIE)?.value || null;\n    const user = token ? await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyToken)(token, _lib_auth__WEBPACK_IMPORTED_MODULE_1__.AUTH_SECRET) : null;\n    const isLoginPage = pathname === \"/login\";\n    const isProtected = PROTECTED_PREFIXES.some((p)=>pathname.startsWith(p)) && !pathname.startsWith(\"/api/auth/login\");\n    if (isLoginPage && user) {\n        const url = req.nextUrl.clone();\n        url.pathname = \"/statistics\";\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    if (isProtected && !user) {\n        const url = req.nextUrl.clone();\n        url.pathname = \"/login\";\n        url.searchParams.set(\"next\", pathname);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(url);\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsZ0JBQWdCO0FBQ3dDO0FBQ1c7QUFFbkUsTUFBTUkscUJBQXFCO0lBQUM7SUFBYTtJQUFpQjtJQUFlO0NBQU87QUFFaEYsK0RBQStEO0FBQ3hELE1BQU1DLFNBQVM7SUFDcEJDLFNBQVM7UUFDUCxrRkFBa0Y7UUFDbEY7S0FDRDtBQUNILEVBQUU7QUFFSyxlQUFlQyxXQUFXQyxHQUFnQjtJQUMvQyxNQUFNLEVBQUVDLFFBQVEsRUFBRSxHQUFHRCxJQUFJRSxPQUFPO0lBRWhDLGdCQUFnQjtJQUNoQixJQUNFRCxTQUFTRSxVQUFVLENBQUMsYUFDcEJGLFNBQVNFLFVBQVUsQ0FBQyxlQUNwQkYsU0FBU0UsVUFBVSxDQUFDLGFBQ3BCRixTQUFTRSxVQUFVLENBQUMsV0FDcEJGLGFBQWEsS0FDYjtRQUNBLE9BQU9ULHFEQUFZQSxDQUFDWSxJQUFJO0lBQzFCO0lBRUEsNkVBQTZFO0lBQzdFLElBQUlILFNBQVNFLFVBQVUsQ0FBQyxpQkFBaUI7UUFDdkMsT0FBT1gscURBQVlBLENBQUNZLElBQUk7SUFDMUI7SUFFQSxNQUFNQyxRQUFRTCxJQUFJTSxPQUFPLENBQUNDLEdBQUcsQ0FBQ1osa0RBQVdBLEdBQUdhLFNBQVM7SUFDckQsTUFBTUMsT0FBT0osUUFBUSxNQUFNWixzREFBV0EsQ0FBQ1ksT0FBT1gsa0RBQVdBLElBQUk7SUFFN0QsTUFBTWdCLGNBQWNULGFBQWE7SUFDakMsTUFBTVUsY0FDSmYsbUJBQW1CZ0IsSUFBSSxDQUFDLENBQUNDLElBQU1aLFNBQVNFLFVBQVUsQ0FBQ1UsT0FDbkQsQ0FBQ1osU0FBU0UsVUFBVSxDQUFDO0lBRXZCLElBQUlPLGVBQWVELE1BQU07UUFDdkIsTUFBTUssTUFBTWQsSUFBSUUsT0FBTyxDQUFDYSxLQUFLO1FBQzdCRCxJQUFJYixRQUFRLEdBQUc7UUFDZixPQUFPVCxxREFBWUEsQ0FBQ3dCLFFBQVEsQ0FBQ0Y7SUFDL0I7SUFFQSxJQUFJSCxlQUFlLENBQUNGLE1BQU07UUFDeEIsTUFBTUssTUFBTWQsSUFBSUUsT0FBTyxDQUFDYSxLQUFLO1FBQzdCRCxJQUFJYixRQUFRLEdBQUc7UUFDZmEsSUFBSUcsWUFBWSxDQUFDQyxHQUFHLENBQUMsUUFBUWpCO1FBQzdCLE9BQU9ULHFEQUFZQSxDQUFDd0IsUUFBUSxDQUFDRjtJQUMvQjtJQUVBLE9BQU90QixxREFBWUEsQ0FBQ1ksSUFBSTtBQUMxQiIsInNvdXJjZXMiOlsiL1VzZXJzL3NoYWh6b2RudW1hbmpvbm92L0Rlc2t0b3AvZWNsaW5pYy1zYWFzL21pZGRsZXdhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWlkZGxld2FyZS50c1xuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgdmVyaWZ5VG9rZW4sIEFVVEhfU0VDUkVULCBBVVRIX0NPT0tJRSB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5cbmNvbnN0IFBST1RFQ1RFRF9QUkVGSVhFUyA9IFtcIi9wYXRpZW50c1wiLCBcIi9hcHBvaW50bWVudHNcIiwgXCIvc3RhdGlzdGljc1wiLCBcIi9hcGlcIl07XG5cbi8vIOKsh+Ksh+KshyBNQVRDSEVSIG5pIHlhbmdpbGFuZzogYXBpL21pbmlhcHAgbmkgY2hpcWFyaWIgdGFzaGxheW1pelxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgbWF0Y2hlcjogW1xuICAgIC8vIF9uZXh0LCBpbWFnZXMsIGZhdmljb24sIGljb25zL2ltZyBWQSBlbmcgbXVoaW1pOiBhcGkvbWluaWFwcCBOSSBFWENMVURFIHFpbGFtaXpcbiAgICBcIi8oKD8hX25leHQvc3RhdGljfF9uZXh0L2ltYWdlfGZhdmljb24uaWNvfGljb25zL3xpbWcvfGFwaS9taW5pYXBwKS4qKVwiLFxuICBdLFxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1pZGRsZXdhcmUocmVxOiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCB7IHBhdGhuYW1lIH0gPSByZXEubmV4dFVybDtcblxuICAvLyBwdWJsaWMgc3RhdGljXG4gIGlmIChcbiAgICBwYXRobmFtZS5zdGFydHNXaXRoKFwiL19uZXh0XCIpIHx8XG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9mYXZpY29uXCIpIHx8XG4gICAgcGF0aG5hbWUuc3RhcnRzV2l0aChcIi9pY29uc1wiKSB8fFxuICAgIHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvaW1nXCIpIHx8XG4gICAgcGF0aG5hbWUgPT09IFwiL1wiXG4gICkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xuICB9XG5cbiAgLy8g4pyFIEFnYXIgYmFyaWJpciBtYXRjaGVyZ2EgdHVzaGliIHFvbHNhIGhhbSwgYXBpL21pbmlhcHDigJluaSBxb+KAmHlpYiB5dWJvcmFtaXpcbiAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvYXBpL21pbmlhcHBcIikpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLm5leHQoKTtcbiAgfVxuXG4gIGNvbnN0IHRva2VuID0gcmVxLmNvb2tpZXMuZ2V0KEFVVEhfQ09PS0lFKT8udmFsdWUgfHwgbnVsbDtcbiAgY29uc3QgdXNlciA9IHRva2VuID8gYXdhaXQgdmVyaWZ5VG9rZW4odG9rZW4sIEFVVEhfU0VDUkVUKSA6IG51bGw7XG5cbiAgY29uc3QgaXNMb2dpblBhZ2UgPSBwYXRobmFtZSA9PT0gXCIvbG9naW5cIjtcbiAgY29uc3QgaXNQcm90ZWN0ZWQgPVxuICAgIFBST1RFQ1RFRF9QUkVGSVhFUy5zb21lKChwKSA9PiBwYXRobmFtZS5zdGFydHNXaXRoKHApKSAmJlxuICAgICFwYXRobmFtZS5zdGFydHNXaXRoKFwiL2FwaS9hdXRoL2xvZ2luXCIpO1xuXG4gIGlmIChpc0xvZ2luUGFnZSAmJiB1c2VyKSB7XG4gICAgY29uc3QgdXJsID0gcmVxLm5leHRVcmwuY2xvbmUoKTtcbiAgICB1cmwucGF0aG5hbWUgPSBcIi9zdGF0aXN0aWNzXCI7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdCh1cmwpO1xuICB9XG5cbiAgaWYgKGlzUHJvdGVjdGVkICYmICF1c2VyKSB7XG4gICAgY29uc3QgdXJsID0gcmVxLm5leHRVcmwuY2xvbmUoKTtcbiAgICB1cmwucGF0aG5hbWUgPSBcIi9sb2dpblwiO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwibmV4dFwiLCBwYXRobmFtZSk7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdCh1cmwpO1xuICB9XG5cbiAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInZlcmlmeVRva2VuIiwiQVVUSF9TRUNSRVQiLCJBVVRIX0NPT0tJRSIsIlBST1RFQ1RFRF9QUkVGSVhFUyIsImNvbmZpZyIsIm1hdGNoZXIiLCJtaWRkbGV3YXJlIiwicmVxIiwicGF0aG5hbWUiLCJuZXh0VXJsIiwic3RhcnRzV2l0aCIsIm5leHQiLCJ0b2tlbiIsImNvb2tpZXMiLCJnZXQiLCJ2YWx1ZSIsInVzZXIiLCJpc0xvZ2luUGFnZSIsImlzUHJvdGVjdGVkIiwic29tZSIsInAiLCJ1cmwiLCJjbG9uZSIsInJlZGlyZWN0Iiwic2VhcmNoUGFyYW1zIiwic2V0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});